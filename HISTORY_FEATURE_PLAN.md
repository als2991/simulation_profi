# –ü–ª–∞–Ω: –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–π

## üéØ –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–π —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫.

## üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### 1. –¢–∞–±–ª–∏—Ü–∞ `user_progress`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `attempt_number INT NOT NULL DEFAULT 1`
- –î–æ–±–∞–≤–∏—Ç—å `id SERIAL PRIMARY KEY` (–Ω–æ–≤—ã–π –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á)
- –ò–∑–º–µ–Ω–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å: `UNIQUE(user_id, profession_id, attempt_number)`
- –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–∏

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
```sql
-- –î–æ–±–∞–≤–∏—Ç—å id –∫–∞–∫ –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
ALTER TABLE user_progress DROP CONSTRAINT user_progress_pkey;
ALTER TABLE user_progress ADD COLUMN id SERIAL;
ALTER TABLE user_progress ADD PRIMARY KEY (id);

-- –î–æ–±–∞–≤–∏—Ç—å attempt_number
ALTER TABLE user_progress ADD COLUMN attempt_number INTEGER NOT NULL DEFAULT 1;

-- –°–æ–∑–¥–∞—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å
CREATE UNIQUE INDEX idx_user_profession_attempt 
ON user_progress(user_id, profession_id, attempt_number);

-- –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–∏
CREATE INDEX idx_user_progress_latest 
ON user_progress(user_id, profession_id, completed_at DESC);
```

### 2. –¢–∞–±–ª–∏—Ü–∞ `user_tasks`
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å `attempt_number INT NOT NULL DEFAULT 1`
- –î–æ–±–∞–≤–∏—Ç—å `progress_id INT` (FK –∫ user_progress)

**–ú–∏–≥—Ä–∞—Ü–∏—è:**
```sql
-- –î–æ–±–∞–≤–∏—Ç—å attempt_number
ALTER TABLE user_tasks ADD COLUMN attempt_number INTEGER NOT NULL DEFAULT 1;

-- –î–æ–±–∞–≤–∏—Ç—å progress_id
ALTER TABLE user_tasks ADD COLUMN progress_id INTEGER;
ALTER TABLE user_tasks ADD FOREIGN KEY (progress_id) REFERENCES user_progress(id) ON DELETE CASCADE;
```

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Backend

### 1. Models (`backend/app/models.py`)
- –û–±–Ω–æ–≤–∏—Ç—å `UserProgress`: –¥–æ–±–∞–≤–∏—Ç—å `id`, `attempt_number`
- –û–±–Ω–æ–≤–∏—Ç—å `UserTask`: –¥–æ–±–∞–≤–∏—Ç—å `attempt_number`, `progress_id`

### 2. Schemas (`backend/app/schemas.py`)
- –î–æ–±–∞–≤–∏—Ç—å `attempt_number` –≤ `UserProgressResponse`
- –î–æ–±–∞–≤–∏—Ç—å `UserProgressHistoryResponse` –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏
- –î–æ–±–∞–≤–∏—Ç—å `AttemptSummary` –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–ø—ã—Ç–æ–∫

### 3. API Endpoints

#### –ù–æ–≤—ã–µ endpoints:
```
GET  /api/professions/{profession_id}/progress/history
     ‚Üí –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫

POST /api/professions/{profession_id}/progress/restart
     ‚Üí –ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–ø—ã—Ç–∫—É (—Å–æ–∑–¥–∞—Ç—å attempt_number + 1)

GET  /api/professions/{profession_id}/progress/{attempt_number}
     ‚Üí –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–æ–ø—ã—Ç–∫—É

GET  /api/tasks/profession/{profession_id}/report/{attempt_number}
     ‚Üí –ü–æ–ª—É—á–∏—Ç—å –æ—Ç—á–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –ø–æ–ø—ã—Ç–∫–∏
```

#### –ò–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ:
- `GET /api/professions/{profession_id}/progress` - –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –ø–æ–ø—ã—Ç–∫—É
- `GET /api/tasks/profession/{profession_id}/current` - —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–µ–∫—É—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
- `GET /api/tasks/profession/{profession_id}/report` - –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—Ç—á–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø–æ–ø—ã—Ç–∫–∏

### 4. –õ–æ–≥–∏–∫–∞ –≤ `routers/professions.py`
- –§—É–Ω–∫—Ü–∏—è `get_latest_progress()` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –ø–æ–ø—ã—Ç–∫—É
- –§—É–Ω–∫—Ü–∏—è `get_progress_history()` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏
- –§—É–Ω–∫—Ü–∏—è `restart_profession()` - —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–ø—ã—Ç–∫—É

### 5. –õ–æ–≥–∏–∫–∞ –≤ `routers/tasks.py`
- –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–≤—è–∑–∫—É `UserTask` –∫ `progress_id`
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞–Ω–∏—è —É–∫–∞–∑—ã–≤–∞—Ç—å `attempt_number`
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏—è –ø–æ —Ç–µ–∫—É—â–µ–π –ø–æ–ø—ã—Ç–∫–µ

## üé® –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ Frontend

### 1. Dashboard (`frontend/app/dashboard/page.tsx`)
–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å:
- "–ü—Ä–æ–π–¥–µ–Ω–æ X —Ä–∞–∑"
- –î–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
- –ö–Ω–æ–ø–∫–∞ "–°–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç" / "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" / "–ù–∞—á–∞—Ç—å"

### 2. Profession Page (`frontend/app/profession/[id]/page.tsx`)
–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç
- –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ"
- –†–∞–∑–¥–µ–ª "–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–π" (accordion)

### 3. API (`frontend/lib/api.ts`)
–î–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏:
- `getProgressHistory(professionId)` - –ø–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
- `restartProfession(professionId)` - –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
- `getAttemptReport(professionId, attemptNumber)` - –æ—Ç—á–µ—Ç –ø–æ–ø—ã—Ç–∫–∏

### 4. –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `ProgressHistory.tsx`
–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ø—ã—Ç–æ–∫ —Å:
- –ù–æ–º–µ—Ä –ø–æ–ø—ã—Ç–∫–∏
- –î–∞—Ç–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
- –ö–Ω–æ–ø–∫–∞ "–°–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á–µ—Ç"

## üìù UX Flow

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–≤–µ—Ä—à–∏–ª –ø—Ä–æ—Ñ–µ—Å—Å–∏—é
```
1. –ü–æ–∫–∞–∑–∞—Ç—å –æ—Ç—á–µ—Ç
2. –ü–æ–∫–∞–∑–∞—Ç—å "–ü—Ä–æ–π–¥–µ–Ω–æ 1 —Ä–∞–∑"
3. –ö–Ω–æ–ø–∫–∏: [–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏—è–º] [–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü—Ä–æ–π—Ç–∏ –∑–∞–Ω–æ–≤–æ"
```
1. API: POST /api/professions/{id}/progress/restart
2. Backend —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å —Å attempt_number = 2
3. Redirect –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–µ—Ä–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
4. –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Å –Ω—É–ª—è
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏
```
1. –ù–∞ –¥–∞—à–±–æ—Ä–¥–µ –ø–æ–∫–∞–∑–∞—Ç—å "–ü—Ä–æ–π–¥–µ–Ω–æ 3 —Ä–∞–∑–∞"
2. –ö–ª–∏–∫ –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏—é ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç + accordion "–ò—Å—Ç–æ—Ä–∏—è"
3. –í –∏—Å—Ç–æ—Ä–∏–∏: "–ü–æ–ø—ã—Ç–∫–∞ 3 (15.01) ‚≠ê –¢–µ–∫—É—â–∞—è", "–ü–æ–ø—ã—Ç–∫–∞ 2 (10.01)", "–ü–æ–ø—ã—Ç–∫–∞ 1 (05.01)"
4. –ö–ª–∏–∫ –Ω–∞ –ø–æ–ø—ã—Ç–∫—É ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å –æ—Ç—á–µ—Ç —Ç–æ–π –ø–æ–ø—ã—Ç–∫–∏
```

## üîÑ –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. ‚úÖ –°–æ–∑–¥–∞—Ç—å SQL –º–∏–≥—Ä–∞—Ü–∏—é
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å Models
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å Schemas
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å backend API
5. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å frontend API –∫–ª–∏–µ–Ω—Ç
6. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å UI Dashboard
7. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å UI Profession Page
8. ‚úÖ –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏—Å—Ç–æ—Ä–∏–∏
9. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç:
- –ü—Ä–æ—Ö–æ–¥–∏—Ç—å –ø—Ä–æ—Ñ–µ—Å—Å–∏—é –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ
- –í–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É "–ü—Ä–æ–π–¥–µ–Ω–æ X —Ä–∞–∑"
- –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –æ—Ç—á–µ—Ç—ã –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å
- –õ–µ–≥–∫–æ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–ø—ã—Ç–∫—É
