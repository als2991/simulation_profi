# ะััะพัะธั ะฟัะพัะพะถะดะตะฝะธะน ะฟัะพัะตััะธะน - ะะตะฐะปะธะทะพะฒะฐะฝะพ โ

## ๐ ะงัะพ ะดะพะฑะฐะฒะปะตะฝะพ

ะะตะฐะปะธะทะพะฒะฐะฝะฐ ะฟะพะปะฝะฐั ะฟะพะดะดะตัะถะบะฐ ะผะฝะพะถะตััะฒะตะฝะฝัั ะฟัะพัะพะถะดะตะฝะธะน ะฟัะพัะตััะธะน ั ัะพััะฐะฝะตะฝะธะตะผ ะธััะพัะธะธ ะฒัะตั ะฟะพะฟััะพะบ.

## ๐ ะัะฟะพะปะฝะตะฝะฝัะต ะธะทะผะตะฝะตะฝะธั

### 1. โ ะะฐะทะฐ ะดะฐะฝะฝัั

**ะคะฐะนะป**: `database/migration_add_attempts.sql`

ะะพะฑะฐะฒะปะตะฝั:
- ะกัะพะปะฑะตั `id` ะบะฐะบ ะฟะตัะฒะธัะฝัะน ะบะปัั ะฒ `user_progress`
- ะกัะพะปะฑะตั `attempt_number` ะดะปั ะพััะปะตะถะธะฒะฐะฝะธั ะฝะพะผะตัะฐ ะฟะพะฟััะบะธ
- ะกัะพะปะฑัั `progress_id` ะธ `attempt_number` ะฒ `user_tasks`
- ะฃะฝะธะบะฐะปัะฝัะน ะธะฝะดะตะบั `(user_id, profession_id, attempt_number)`
- ะะฝะดะตะบัั ะดะปั ะฑััััะพะณะพ ะฟะพะธัะบะฐ ะฟะพัะปะตะดะฝะตะน ะฟะพะฟััะบะธ

### 2. โ Backend Models (`backend/app/models.py`)

**UserProgress**:
- `id`: ะฝะพะฒัะน ะฟะตัะฒะธัะฝัะน ะบะปัั
- `attempt_number`: ะฝะพะผะตั ะฟะพะฟััะบะธ (ะฟะพ ัะผะพะปัะฐะฝะธั 1)
- `tasks`: relationship ะบ UserTask

**UserTask**:
- `progress_id`: FK ะบ user_progress
- `attempt_number`: ะฝะพะผะตั ะฟะพะฟััะบะธ
- `progress`: relationship ะบ UserProgress

### 3. โ Backend Schemas (`backend/app/schemas.py`)

ะะพะฑะฐะฒะปะตะฝั:
- `AttemptSummary`: ะบัะฐัะบะฐั ะธะฝัะพัะผะฐัะธั ะพ ะฟะพะฟััะบะต
- `ProgressHistoryResponse`: ะธััะพัะธั ะฒัะตั ะฟะพะฟััะพะบ
- ะะพะปั `id` ะธ `attempt_number` ะฒ `UserProgressResponse`

### 4. โ Backend API (`backend/app/routers/`)

**ะะพะฒัะต endpoints**:

```python
GET  /api/professions/{profession_id}/progress
     โ ะะพะปััะธัั ะฟะพัะปะตะดะฝัั ะฟะพะฟััะบั

GET  /api/professions/{profession_id}/progress/history
     โ ะะพะปััะธัั ะธััะพัะธั ะฒัะตั ะฟะพะฟััะพะบ

GET  /api/professions/{profession_id}/progress/{attempt_number}
     โ ะะพะปััะธัั ะบะพะฝะบัะตัะฝัั ะฟะพะฟััะบั

POST /api/professions/{profession_id}/progress/restart
     โ ะะฐัะฐัั ะฝะพะฒัั ะฟะพะฟััะบั

GET  /api/tasks/profession/{profession_id}/report?attempt_number=N
     โ ะะพะปััะธัั ะพััะตั ะบะพะฝะบัะตัะฝะพะน ะฟะพะฟััะบะธ (ะฟะพ ัะผะพะปัะฐะฝะธั ะฟะพัะปะตะดะฝัั)
```

**ะะทะผะตะฝะตะฝะธั ะฒ ะปะพะณะธะบะต**:
- ะัะต ะทะฐะฟัะพัั ัะตะฟะตัั ัะฐะฑะพัะฐัั ั ะฟะพัะปะตะดะฝะตะน ะฟะพะฟััะบะพะน (ะฟะพ `attempt_number DESC`)
- `UserTask` ะฟัะธะฒัะทัะฒะฐะตััั ะบ ะบะพะฝะบัะตัะฝะพะน ะฟะพะฟััะบะต ัะตัะตะท `progress_id`
- ะัะธ ัะพะทะดะฐะฝะธะธ ะฝะพะฒะพะณะพ ะฟัะพัะพะถะดะตะฝะธั ะธะฝะบัะตะผะตะฝัะธััะตััั `attempt_number`

### 5. โ Frontend API (`frontend/lib/api.ts`)

ะะพะฑะฐะฒะปะตะฝั ััะฝะบัะธะธ:
- `getProgressHistory(professionId)` - ะฟะพะปััะธัั ะธััะพัะธั
- `getSpecificAttempt(professionId, attemptNumber)` - ะฟะพะปััะธัั ะฟะพะฟััะบั
- `restartProfession(professionId)` - ะฝะฐัะฐัั ะทะฐะฝะพะฒะพ
- `getFinalReport(professionId, attemptNumber?)` - ะพััะตั ั ะพะฟัะธะพะฝะฐะปัะฝัะผ ะฝะพะผะตัะพะผ ะฟะพะฟััะบะธ

### 6. โ Dashboard UI (`frontend/app/dashboard/page.tsx`)

ะัะพะฑัะฐะถะฐะตััั:
- ะะพะผะตั ัะตะบััะตะน ะฟะพะฟััะบะธ ััะดะพะผ ัะพ ััะฐัััะพะผ
- "ะะพะฟััะบะฐ 1", "ะะพะฟััะบะฐ 2", ะธ ั.ะด.

### 7. โ Profession Page (`frontend/app/profession/[id]/page.tsx`)

ะัะธ ะทะฐะฒะตััะตะฝะธะธ ะฟัะพัะตััะธะธ:
- ะัะพะฑัะฐะถะฐะตััั ัะธะฝะฐะปัะฝัะน ะพััะตั ั ะฝะพะผะตัะพะผ ะฟะพะฟััะบะธ
- ะะฝะพะฟะบะฐ **"ะัะพะนัะธ ะทะฐะฝะพะฒะพ"** ะดะปั ะฝะฐัะฐะปะฐ ะฝะพะฒะพะน ะฟะพะฟััะบะธ
- ะะฐะทะดะตะป **"ะััะพัะธั ะฟัะพัะพะถะดะตะฝะธะน"** (accordion)
  - ะะพะบะฐะทัะฒะฐะตััั ะตัะปะธ ะตััั > 1 ะฟะพะฟััะบะธ
  - ะกะฟะธัะพะบ ะฒัะตั ะฟะพะฟััะพะบ ั ะดะฐัะฐะผะธ
  - ะะพะทะผะพะถะฝะพััั ะฟะพัะผะพััะตัั ะพััะตัั ะฟัะตะดัะดััะธั ะฟะพะฟััะพะบ
  - ะัะผะตัะบะฐ โญ ัะตะบััะตะน ะฟะพะฟััะบะธ

## ๐ ะะฝััััะบัะธั ะฟะพ ะฟัะธะผะตะฝะตะฝะธั

### ะจะฐะณ 1: ะัะธะผะตะฝะธัั ะผะธะณัะฐัะธั ะะ

```bash
# ะะพะดะบะปััะธัะตัั ะบ ัะตัะฒะตัั
ssh root@178.208.78.63

# ะะตัะตะนะดะธัะต ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
cd /root/simulation_profi

# ะัะธะผะตะฝะธัะต ะผะธะณัะฐัะธั
sudo -u postgres psql -d profession_simulator -f database/migration_add_attempts.sql

# ะัะพะฒะตัััะต ัะตะทัะปััะฐั
sudo -u postgres psql -d profession_simulator -c "SELECT column_name FROM information_schema.columns WHERE table_name = 'user_progress';"
```

**ะะถะธะดะฐะตะผัะน ัะตะทัะปััะฐั**: ะดะพะปะถะฝั ะฟะพัะฒะธัััั ััะพะปะฑัั `id` ะธ `attempt_number`.

### ะจะฐะณ 2: ะะฑะฝะพะฒะธัั Backend

```bash
# ะะตัะตะทะฐะฟัััะธัะต backend
cd /root/simulation_profi/backend
sudo systemctl restart profession-simulator

# ะะปะธ ะตัะปะธ ะทะฐะฟััะตะฝ ะฒัััะฝัั:
# Ctrl+C
source venv/bin/activate
uvicorn main:app --host 0.0.0.0 --port 8002

# ะัะพะฒะตัััะต ะปะพะณะธ
sudo journalctl -u profession-simulator -f
```

### ะจะฐะณ 3: ะะฑะฝะพะฒะธัั Frontend

```bash
# ะะตัะตะนะดะธัะต ะฒ ะดะธัะตะบัะพัะธั frontend
cd /root/simulation_profi/frontend

# ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ (ะตัะปะธ ะฝัะถะฝะพ)
npm install

# ะะตัะตัะพะฑะตัะธัะต ะฟัะพะตะบั
npm run build

# ะะตัะตะทะฐะฟัััะธัะต frontend
pm2 restart profession-simulator-frontend

# ะะปะธ ะตัะปะธ ะทะฐะฟััะตะฝ ะฒัััะฝัั:
# Ctrl+C
npm run start

# ะัะพะฒะตัััะต ััะฐััั
pm2 status
```

### ะจะฐะณ 4: ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ

1. ะัะบัะพะนัะต ัะฐะนั ะฒ ะฑัะฐัะทะตัะต
2. ะะพะนะดะธัะต ะฒ ะฐะบะบะฐัะฝั
3. ะะตัะตะนะดะธัะต ะฝะฐ ะดะฐัะฑะพัะด - ะดะพะปะถะตะฝ ะพัะพะฑัะฐะถะฐัััั ะฝะพะผะตั ะฟะพะฟััะบะธ
4. ะะฐะฒะตััะธัะต ะฟัะพัะตััะธั (ะตัะปะธ ัะถะต ะฑัะปะฐ ะทะฐะฒะตััะตะฝะฐ)
5. ะะฐ ัััะฐะฝะธัะต ะพััะตัะฐ ะดะพะปะถะฝั ะฟะพัะฒะธัััั:
   - ะะฝะพะฟะบะฐ "ะัะพะนัะธ ะทะฐะฝะพะฒะพ"
   - ะะฐะทะดะตะป "ะััะพัะธั ะฟัะพัะพะถะดะตะฝะธะน" (ะตัะปะธ > 1 ะฟะพะฟััะบะธ)
6. ะะฐะถะผะธัะต "ะัะพะนัะธ ะทะฐะฝะพะฒะพ"
7. ะัะพะนะดะธัะต ะฟัะพัะตััะธั ัะฝะพะฒะฐ
8. ะ ะธััะพัะธะธ ะดะพะปะถะฝั ะฟะพัะฒะธัััั ะพะฑะต ะฟะพะฟััะบะธ

## ๐ฏ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะะพะปัะทะพะฒะฐัะตะปั ะทะฐะฒะตััะธะป ะฟัะพัะตััะธั ะฟะตัะฒัะน ัะฐะท

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะคะธะฝะฐะปัะฝัะน ะพัััั    ะะพะฟััะบะฐ 1       โ
โ                                     โ
โ  [ะััะตั ั ะพัะตะฝะบะพะน...]               โ
โ                                     โ
โ  [ะัะพะนัะธ ะทะฐะฝะพะฒะพ] [ะ ะฟัะพัะตััะธัะผ]     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะพัะปะต ะฒัะพัะพะณะพ ะฟัะพัะพะถะดะตะฝะธั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะคะธะฝะฐะปัะฝัะน ะพัััั    ะะพะฟััะบะฐ 2       โ
โ                                     โ
โ  [ะััะตั ั ะพัะตะฝะบะพะน...]               โ
โ                                     โ
โ  [ะัะพะนัะธ ะทะฐะฝะพะฒะพ] [ะ ะฟัะพัะตััะธัะผ]     โ
โ                                     โ
โ  ๐ ะััะพัะธั ะฟัะพัะพะถะดะตะฝะธะน (2) โผ       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โ  โ ะะพะฟััะบะฐ 2  15.01.2026  โญ   โ    โ
โ  โ ะะพะฟััะบะฐ 1  10.01.2026       โ    โ
โ  โ           [ะกะผะพััะตัั ะพััะตั]  โ    โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะฐ ะดะฐัะฑะพัะดะต

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Project Manager            โ
โ  ะะฝัะตัะฐะบัะธะฒะฝะฐั ัะธะผัะปััะธั... โ
โ                             โ
โ  โ ะะฐะฒะตััะตะฝะพ  ะะพะฟััะบะฐ 2    โ
โ                             โ
โ  [ะะพัะผะพััะตัั ะพัััั]         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ API Examples

### ะะฐัะฐัั ะฝะพะฒัั ะฟะพะฟััะบั

```bash
curl -X POST http://178.208.78.63:8002/api/professions/1/progress/restart \
  -H "Authorization: Bearer YOUR_TOKEN"

# ะัะฒะตั:
{
  "id": 5,
  "profession_id": 1,
  "attempt_number": 3,
  "status": "in_progress",
  "current_task_order": 0,
  ...
}
```

### ะะพะปััะธัั ะธััะพัะธั

```bash
curl http://178.208.78.63:8002/api/professions/1/progress/history \
  -H "Authorization: Bearer YOUR_TOKEN"

# ะัะฒะตั:
{
  "profession_id": 1,
  "total_attempts": 3,
  "attempts": [
    {
      "id": 5,
      "attempt_number": 3,
      "status": "completed",
      "started_at": "2026-01-15T10:00:00Z",
      "completed_at": "2026-01-15T11:30:00Z"
    },
    ...
  ]
}
```

### ะะพะปััะธัั ะพััะตั ะบะพะฝะบัะตัะฝะพะน ะฟะพะฟััะบะธ

```bash
curl "http://178.208.78.63:8002/api/tasks/profession/1/report?attempt_number=2" \
  -H "Authorization: Bearer YOUR_TOKEN"

# ะัะฒะตั:
{
  "final_report": "ะะฐั ะพััะตั ะฟะพ ะฟะพะฟััะบะต 2...",
  "attempt_number": 2,
  "completed_at": "2026-01-10T12:00:00Z"
}
```

## ๐ ะกัััะบัััะฐ ะดะฐะฝะฝัั

### user_progress

| id | user_id | profession_id | attempt_number | status | current_task_order | final_report | completed_at |
|----|---------|---------------|----------------|--------|--------------------|--------------|--------------|
| 1  | 1       | 1             | 1              | completed | 3 | "ะััะตั..." | 2026-01-10 |
| 2  | 1       | 1             | 2              | completed | 3 | "ะััะตั..." | 2026-01-15 |
| 3  | 1       | 1             | 3              | in_progress | 1 | NULL | NULL |

### user_tasks

| id | user_id | task_id | progress_id | attempt_number | question | answer | completed_at |
|----|---------|---------|-------------|----------------|----------|--------|--------------|
| 1  | 1       | 1       | 1           | 1              | "Q1..."  | "A1"   | 2026-01-10 |
| 2  | 1       | 2       | 1           | 1              | "Q2..."  | "A2"   | 2026-01-10 |
| 3  | 1       | 1       | 2           | 2              | "Q1..."  | "A1b"  | 2026-01-15 |

## โ๏ธ ะะฐะถะฝัะต ะทะฐะผะตัะฐะฝะธั

1. **ะกััะตััะฒัััะธะต ะดะฐะฝะฝัะต**: ะผะธะณัะฐัะธั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัััะฐะฝะพะฒะธั `attempt_number = 1` ะดะปั ะฒัะตั ัััะตััะฒัััะธั ะทะฐะฟะธัะตะน.

2. **ะฃะฝะธะบะฐะปัะฝะพััั**: ัะตะฟะตัั ะฟะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะธะผะตัั ะฝะตัะบะพะปัะบะพ ะทะฐะฟะธัะตะน ะดะปั ะพะดะฝะพะน ะฟัะพัะตััะธะธ, ะฝะพ ั ัะฐะทะฝัะผะธ `attempt_number`.

3. **ะะฐัะบะฐะดะฝะพะต ัะดะฐะปะตะฝะธะต**: ะฟัะธ ัะดะฐะปะตะฝะธะธ `user_progress` ะฒัะต ัะฒัะทะฐะฝะฝัะต `user_tasks` ัะดะฐะปััััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฑะปะฐะณะพะดะฐัั `ON DELETE CASCADE`.

4. **ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั**: ะดะพะฑะฐะฒะปะตะฝั ะธะฝะดะตะบัั ะดะปั ะฑััััะพะณะพ ะฟะพะธัะบะฐ ะฟะพัะปะตะดะฝะตะน ะฟะพะฟััะบะธ.

5. **ะะฑัะฐัะฝะฐั ัะพะฒะผะตััะธะผะพััั**: API endpoint `/api/professions/{id}/progress` ะฟัะพะดะพะปะถะฐะตั ัะฐะฑะพัะฐัั, ะฝะพ ัะตะฟะตัั ะฒะพะทะฒัะฐัะฐะตั ะฟะพัะปะตะดะฝัั ะฟะพะฟััะบั.

## ๐จ UX ะพัะพะฑะตะฝะฝะพััะธ

- **ะะพะฝััะฝะพััั**: ะฟะพะปัะทะพะฒะฐัะตะปั ะฒัะตะณะดะฐ ะฒะธะดะธั ะฝะพะผะตั ัะตะบััะตะน ะฟะพะฟััะบะธ
- **ะะพัะธะฒะฐัะธั**: ะฒะพะทะผะพะถะฝะพััั ัะปัััะธัั ัะตะทัะปััะฐั
- **ะััะพัะธั**: ะฟะพะปะฝะฐั ะฟัะพะทัะฐัะฝะพััั ะฒัะตั ะฟะพะฟััะพะบ
- **ะัะพััะพัะฐ**: ะพะดะฝะฐ ะบะฝะพะฟะบะฐ "ะัะพะนัะธ ะทะฐะฝะพะฒะพ" ะดะปั ะฝะฐัะฐะปะฐ ะฝะพะฒะพะน ะฟะพะฟััะบะธ
- **ะะตะทะพะฟะฐัะฝะพััั**: ััะฐััะต ะดะฐะฝะฝัะต ัะพััะฐะฝััััั ะธ ะฝะต ะฟะตัะตะทะฐะฟะธััะฒะฐัััั

## โ ะะพัะพะฒะพ!

ะขะตะฟะตัั ะฟะพะปัะทะพะฒะฐัะตะปะธ ะผะพะณัั:
- ะัะพัะพะดะธัั ะฟัะพัะตััะธั ะผะฝะพะณะพะบัะฐัะฝะพ
- ะะธะดะตัั ะธััะพัะธั ะฒัะตั ะฟะพะฟััะพะบ
- ะัะพัะผะฐััะธะฒะฐัั ะพััะตัั ะฒัะตั ะทะฐะฒะตััะตะฝะฝัั ะฟะพะฟััะพะบ
- ะััะปะตะถะธะฒะฐัั ัะฒะพะน ะฟัะพะณัะตัั
- ะะตะณะบะพ ะฝะฐัะฐัั ะฝะพะฒัั ะฟะพะฟััะบั ะพะดะฝะธะผ ะบะปะธะบะพะผ

ะัะต ััะฐััะต ะดะฐะฝะฝัะต ัะพััะฐะฝะตะฝั ะธ ะฟัะพะดะพะปะถะฐั ัะฐะฑะพัะฐัั! ๐
